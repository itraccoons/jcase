# CircleCI 2.0 configuration file
# Build Java Projects with Gradle
# Written by: Oleksii Kucheruk <ok@raccoons.co> on Fri Oct 5 2018
---
version: 2

jobs:

  validate:
    working_directory: ~/work
    docker: [{image: 'circleci/openjdk:10-jdk'}]
    steps:
      - checkout
      - setup_remote_docker:
          reusable: true
          exclusive: false
      - run:
          name: "Validate phase"
          command: |
            make validate-ci
            make validate-src

  test:
    working_directory: ~/work
    docker: [{image: 'circleci/openjdk:10-jdk'}]
    steps:
    - checkout
    - setup_remote_docker
    - run:
        name: "Unit test phase"
        command: make test

  build:
    working_directory: ~/work
    docker: [{image: 'circleci/openjdk:10-jdk'}]
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: "Build phase"
          command: make build

#  test:
#    working_directory: /work
#    docker: [{image: 'docker:17.06-git'}]
#    steps:
#      - checkout
#      - setup_remote_docker
#      - run:
#          name: "Test"

      - store_artifacts:
          path: ~/work/artifacts

workflows:
  version: 2
  ci:
    jobs:
      - validate
      - test
      - build
